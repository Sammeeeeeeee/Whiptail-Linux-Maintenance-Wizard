#!/bin/bash

# Define the URL for the script
SCRIPT_URL="https://github.com/Sammeeeeeeee/Whiptail-Linux-Maintenance-Wizard/raw/main/LinuxMaintinanceTool.sh"
SCRIPT_PATH="/usr/local/bin/lmt.sh"

# Show input box for user to enter the alias
SELECTED_ALIAS=$(whiptail --title "Alias Input" --inputbox "Enter the alias you want to create:" 10 60 "lmt" 3>&1 1>&2 2>&3)

# Check if the user pressed Cancel or Escape
if [ $? -ne 0 ]; then
    echo "User canceled the operation."
    exit 1
fi

# Validate the input
if [[ -z "$SELECTED_ALIAS" ]]; then
    whiptail --title "Error" --msgbox "Alias cannot be empty. Please run the script again." 8 45
    exit 1
fi

# Define the alias command based on user input
ALIAS_COMMAND="alias $SELECTED_ALIAS='$SCRIPT_PATH'"

# Show progress gauge
{
    whiptail --title "Progress" --gauge "Downloading and setting up the script..." 10 60 0 &
    
    # Download the script and set executable permissions
    wget -qO "$SCRIPT_PATH" "$SCRIPT_URL"
    if [ $? -ne 0 ]; then
        whiptail --title "Error" --msgbox "Failed to download the script. Please check your internet connection or the URL." 8 45
        exit 1
    fi
    
    chmod +x "$SCRIPT_PATH"
    if [ $? -ne 0 ]; then
        whiptail --title "Error" --msgbox "Failed to set executable permissions on the script." 8 45
        exit 1
    fi

    # Indicate progress completion
    echo 100
} | whiptail --title "Progress" --gauge "Setting up the script..." 10 60 0

# Determine the shell configuration file to update
if [ -n "$ZSH_VERSION" ]; then
    SHELL_CONFIG="$HOME/.zshrc"
elif [ -n "$BASH_VERSION" ]; then
    SHELL_CONFIG="$HOME/.bashrc"
else
    whiptail --title "Error" --msgbox "Unsupported shell. Please add the alias manually." 8 45
    exit 1
fi

# Add the alias command to the shell configuration file
if grep -q "^alias $SELECTED_ALIAS=" "$SHELL_CONFIG"; then
    whiptail --title "Info" --msgbox "Alias already exists in $SHELL_CONFIG" 8 45
else
    echo "$ALIAS_COMMAND" >> "$SHELL_CONFIG"
    whiptail --title "Success" --msgbox "Alias added to $SHELL_CONFIG" 8 45
fi

# Provide instructions to reload the shell configuration
whiptail --title "Instructions" --msgbox "To apply the changes, run:\n\nsource $SHELL_CONFIG" 12 45
